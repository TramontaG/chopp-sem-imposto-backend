{"version":3,"file":"userController.js","names":["_firestore","require","_","_interopRequireDefault","_eventsController","_yasms","_SafeDatabaseTransaction","_cryptoService","e","__esModule","default","ownKeys","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","MINUTE_IN_MS","userMemo","createMemoService","undefined","userDB","DbManager","queries","filterByPhoneNumber","phoneNumber","createQuery","q","where","Filter","and","filterByIds","ids","getAll","getAllConfirmed","getByOrigin","origin","userManager","createUser","name","city","DOB","source","confirmed","deleteData","phoneNotInUse","assertPhoneNotInUse","fullUser","getUserByPhoneNumber","updateUser","id","transactionError","FAIL_REASONS","ALREADY_EXISTS","crypto","randomUUID","userData","Boolean","eventsAttended","createdAt","Date","now","updatedAt","deletedAt","neighborhood","profession","sex","upsertEntity","transactionSuccess","createUserAvoidingDuplicates","upsertUser","data","TYPE_MISMATCH","getAllUsers","runQuery","userExists","assertUserExists","NOT_FOUND","getUserById","getData","readEntity","then","val","deleteUser","hardDeleteUser","deleteEntity","exists","entityExists","results","userAttendToEvent","userId","eventId","eventExists","eventsController","assertEventExists","FieldValue","arrayUnion","updateEvent","attendees","success","userInterestedInEvent","interested","invited","userInvitedToEvent","getUsersByIds","users","getTotalUsers","usersAmount","countByQuery","amount","getConfirmationPayload","eventCofirmationCryptoService","encrypt","action","getUsersByOrigin","_default","exports"],"sources":["../../../src/database/controllers/userController.ts"],"sourcesContent":["import { FieldValue, Filter } from \"firebase-admin/firestore\";\nimport DbManager from \"..\";\nimport type {\n  AllEntitiesModel,\n  DatabaseFriendlyEntityModel,\n  WithID,\n} from \"../schemas\";\nimport eventsController from \"./eventsController.\";\nimport { createMemoService } from \"yasms\";\nimport {\n  FAIL_REASONS,\n  transactionError,\n  transactionSuccess,\n} from \"../../Util/SafeDatabaseTransaction\";\nimport { eventCofirmationCryptoService } from \"../../Util/crypto-service\";\n\nconst MINUTE_IN_MS = 1000 * 60;\nconst userMemo = createMemoService(undefined, MINUTE_IN_MS);\nconst userDB = DbManager(\"user\");\n\nconst queries = {\n  filterByPhoneNumber: (phoneNumber: string) => {\n    return userDB.createQuery((q) =>\n      q.where(\n        Filter.and(\n          Filter.where(\"phoneNumber\", \"==\", phoneNumber),\n          Filter.where(\"deletedAt\", \"==\", null)\n        )\n      )\n    );\n  },\n  filterByIds: (ids: string[]) => {\n    return userDB.createQuery((q) => q.where(\"id\", \"in\", ids));\n  },\n  getAll: () => {\n    return userDB.createQuery((q) => q.where(\"deletedAt\", \"==\", null));\n  },\n  getAllConfirmed: () => {\n    return userDB.createQuery((q) =>\n      q.where(\n        Filter.and(\n          Filter.where(\"deletedAt\", \"==\", null),\n          Filter.where(\"confirmed\", \"==\", true)\n        )\n      )\n    );\n  },\n  getByOrigin: (origin: string) => {\n    return userDB\n      .createQuery((q) => q.where(\"source\", \"==\", origin))\n      .where(\"deletedAt\", \"==\", null);\n  },\n};\n\nconst userManager = () => {\n  const createUser = async ({\n    name,\n    phoneNumber,\n    city,\n    DOB,\n    source,\n    confirmed,\n  }: {\n    name: string;\n    phoneNumber: string;\n    city: string;\n    DOB: number | null;\n    source: AllEntitiesModel[\"user\"][\"source\"] | null;\n    confirmed: boolean | null;\n  }) => {\n    userMemo.deleteData(`queryphone-${phoneNumber}`); //should be removed\n\n    const phoneNotInUse = await assertPhoneNotInUse(phoneNumber);\n    if (!phoneNotInUse) {\n      const fullUser = await getUserByPhoneNumber(phoneNumber);\n      await updateUser(fullUser.id, {\n        confirmed: true,\n        name,\n        city,\n        source: source ?? \"referral\",\n      });\n      return transactionError(FAIL_REASONS.ALREADY_EXISTS);\n    }\n\n    const id = `${name}-${crypto.randomUUID()}`;\n    const userData: AllEntitiesModel[\"user\"] = {\n      name,\n      phoneNumber,\n      city,\n      DOB,\n      confirmed: Boolean(confirmed),\n      eventsAttended: [],\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n      deletedAt: null,\n      neighborhood: null,\n      profession: null,\n      sex: null,\n      source: source || \"novo\",\n    };\n\n    await userDB.upsertEntity(id, userData);\n\n    return transactionSuccess({ id });\n  };\n\n  const createUserAvoidingDuplicates = async ({\n    name,\n    phoneNumber,\n    city,\n    DOB,\n    source,\n    confirmed,\n  }: {\n    name: string;\n    phoneNumber: string;\n    city: string;\n    DOB: number | null;\n    source: AllEntitiesModel[\"user\"][\"source\"] | null;\n    confirmed: boolean | null;\n  }) => {\n    const phoneNotInUse = await assertPhoneNotInUse(phoneNumber);\n    if (!phoneNotInUse) {\n      return transactionError(FAIL_REASONS.ALREADY_EXISTS);\n    }\n\n    const id = `${name}-${crypto.randomUUID()}`;\n    const userData: AllEntitiesModel[\"user\"] = {\n      name,\n      phoneNumber,\n      city,\n      DOB,\n      confirmed: Boolean(confirmed),\n      eventsAttended: [],\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n      deletedAt: null,\n      neighborhood: null,\n      profession: null,\n      sex: null,\n      source: source || \"novo\",\n    };\n\n    await userDB.upsertEntity(id, userData);\n    return transactionSuccess({ id });\n  };\n\n  const upsertUser = async (data: Partial<WithID<\"user\">>) => {\n    if (data.id) {\n      userMemo.deleteData(data.id);\n\n      return updateUser(data.id, {\n        ...data,\n      });\n    } else {\n      const { name, phoneNumber, city } = data;\n      if (!name || !phoneNumber || !city) {\n        return transactionError(FAIL_REASONS.TYPE_MISMATCH);\n      }\n\n      return createUser({\n        city,\n        confirmed: true,\n        phoneNumber,\n        name,\n        source: data.source || \"referral\",\n        DOB: data.DOB ?? null,\n      });\n    }\n  };\n\n  const getAllUsers = async (confirmed?: boolean) => {\n    const data = await userDB.runQuery(\n      confirmed ? queries.getAllConfirmed() : queries.getAll()\n    );\n    return data;\n  };\n\n  const updateUser = async (\n    id: string,\n    data: Partial<DatabaseFriendlyEntityModel<\"user\">>\n  ) => {\n    userMemo.deleteData(id);\n    const userExists = await assertUserExists(id);\n\n    if (!userExists) {\n      return transactionError(FAIL_REASONS.NOT_FOUND);\n    }\n\n    await userDB.upsertEntity(id, {\n      ...data,\n      updatedAt: Date.now(),\n    });\n\n    return transactionSuccess(await getUserById(id));\n  };\n\n  const getUserById = (id: string): Promise<WithID<\"user\">> => {\n    return userMemo\n      .getData(id, () => userDB.readEntity(id))\n      .then((val) => val.data);\n  };\n\n  const deleteUser = (id: string) => {\n    userMemo.deleteData(id);\n    return userDB.upsertEntity(id, { deletedAt: Date.now() });\n  };\n\n  const hardDeleteUser = (id: string) => {\n    userMemo.deleteData(id);\n    return userDB.deleteEntity(id);\n  };\n\n  const assertUserExists = async (id: string): Promise<boolean> => {\n    const exists = await userMemo\n      .getData(`exists/${id}`, () => userDB.entityExists(id))\n      .then((val) => val.data);\n\n    return exists;\n  };\n\n  const assertPhoneNotInUse = async (phoneNumber: string): Promise<boolean> => {\n    const results: WithID<\"user\">[] = await userMemo\n      .getData(`queryphone-${phoneNumber}`, () =>\n        userDB.runQuery(queries.filterByPhoneNumber(phoneNumber))\n      )\n      .then((val) => val.data);\n\n    return results.length === 0;\n  };\n\n  const getUserByPhoneNumber = async (phoneNumber: string) => {\n    const results: WithID<\"user\">[] = await userDB.runQuery(\n      queries.filterByPhoneNumber(phoneNumber)\n    );\n\n    return results[0];\n  };\n\n  const userAttendToEvent = async (userId: string, eventId: string) => {\n    const userExists = await assertUserExists(userId);\n    if (!userExists) return transactionError(FAIL_REASONS.NOT_FOUND);\n\n    const eventExists = await eventsController.assertEventExists(eventId);\n    if (!eventExists) return transactionError(FAIL_REASONS.NOT_FOUND);\n\n    updateUser(userId, {\n      eventsAttended: FieldValue.arrayUnion(eventId),\n    });\n\n    eventsController.updateEvent(eventId, {\n      attendees: FieldValue.arrayUnion(userId),\n    });\n\n    return transactionSuccess({ success: true });\n  };\n\n  const userInterestedInEvent = async (userId: string, eventId: string) => {\n    const userExists = await assertUserExists(userId);\n    if (!userExists) return transactionError(FAIL_REASONS.NOT_FOUND);\n\n    const eventExists = await eventsController.assertEventExists(eventId);\n    if (!eventExists) return transactionError(FAIL_REASONS.NOT_FOUND);\n\n    eventsController.updateEvent(eventId, {\n      interested: FieldValue.arrayUnion(userId),\n      invited: FieldValue.arrayUnion(userId),\n    });\n\n    return transactionSuccess({ success: true });\n  };\n\n  const userInvitedToEvent = async (userId: string, eventId: string) => {\n    const userExists = await assertUserExists(userId);\n    if (!userExists) return transactionError(FAIL_REASONS.NOT_FOUND);\n\n    const eventExists = await eventsController.assertEventExists(eventId);\n    if (!eventExists) return transactionError(FAIL_REASONS.NOT_FOUND);\n\n    eventsController.updateEvent(eventId, {\n      invited: FieldValue.arrayUnion(userId),\n    });\n\n    return transactionSuccess({ success: true });\n  };\n\n  const getUsersByIds = async (ids: string[]) => {\n    const users = await userDB.runQuery(queries.filterByIds(ids));\n    return users;\n  };\n\n  const getTotalUsers = async (confirmed: boolean) => {\n    const usersAmount = await userDB.countByQuery(\n      confirmed ? queries.getAllConfirmed() : queries.getAll()\n    );\n    return transactionSuccess({ amount: usersAmount });\n  };\n\n  const getConfirmationPayload = async (userId: string, eventId: string) => {\n    const userExists = await assertUserExists(userId);\n    if (!userExists) return transactionError(FAIL_REASONS.NOT_FOUND);\n\n    const eventExists = await eventsController.assertEventExists(eventId);\n    if (!eventExists) return transactionError(FAIL_REASONS.NOT_FOUND);\n\n    return transactionSuccess(\n      eventCofirmationCryptoService.encrypt({\n        action: \"confirm\",\n        eventId,\n        userId,\n      })\n    );\n  };\n\n  const getUsersByOrigin = (origin: string) => {\n    return userDB.runQuery(queries.getByOrigin(origin));\n  };\n\n  return {\n    createUser,\n    getAllUsers,\n    updateUser,\n    getUserById,\n    getUserByPhoneNumber,\n    deleteUser,\n    hardDeleteUser,\n    assertUserExists,\n    getUsersByIds,\n    assertPhoneNotInUse,\n    userAttendToEvent,\n    upsertUser,\n    createUserAvoidingDuplicates,\n    getUsersByOrigin,\n    userInterestedInEvent,\n    userInvitedToEvent,\n    getTotalUsers,\n    getConfirmationPayload,\n  };\n};\n\nexport default userManager();\n"],"mappings":";;;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AACA,IAAAC,CAAA,GAAAC,sBAAA,CAAAF,OAAA;AAMA,IAAAG,iBAAA,GAAAD,sBAAA,CAAAF,OAAA;AACA,IAAAI,MAAA,GAAAJ,OAAA;AACA,IAAAK,wBAAA,GAAAL,OAAA;AAKA,IAAAM,cAAA,GAAAN,OAAA;AAA0E,SAAAE,uBAAAK,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAAA,SAAAG,QAAAH,CAAA,EAAAI,CAAA,QAAAC,CAAA,GAAAC,MAAA,CAAAC,IAAA,CAAAP,CAAA,OAAAM,MAAA,CAAAE,qBAAA,QAAAC,CAAA,GAAAH,MAAA,CAAAE,qBAAA,CAAAR,CAAA,GAAAI,CAAA,KAAAK,CAAA,GAAAA,CAAA,CAAAC,MAAA,WAAAN,CAAA,WAAAE,MAAA,CAAAK,wBAAA,CAAAX,CAAA,EAAAI,CAAA,EAAAQ,UAAA,OAAAP,CAAA,CAAAQ,IAAA,CAAAC,KAAA,CAAAT,CAAA,EAAAI,CAAA,YAAAJ,CAAA;AAAA,SAAAU,cAAAf,CAAA,aAAAI,CAAA,MAAAA,CAAA,GAAAY,SAAA,CAAAC,MAAA,EAAAb,CAAA,UAAAC,CAAA,WAAAW,SAAA,CAAAZ,CAAA,IAAAY,SAAA,CAAAZ,CAAA,QAAAA,CAAA,OAAAD,OAAA,CAAAG,MAAA,CAAAD,CAAA,OAAAa,OAAA,WAAAd,CAAA,IAAAe,eAAA,CAAAnB,CAAA,EAAAI,CAAA,EAAAC,CAAA,CAAAD,CAAA,SAAAE,MAAA,CAAAc,yBAAA,GAAAd,MAAA,CAAAe,gBAAA,CAAArB,CAAA,EAAAM,MAAA,CAAAc,yBAAA,CAAAf,CAAA,KAAAF,OAAA,CAAAG,MAAA,CAAAD,CAAA,GAAAa,OAAA,WAAAd,CAAA,IAAAE,MAAA,CAAAgB,cAAA,CAAAtB,CAAA,EAAAI,CAAA,EAAAE,MAAA,CAAAK,wBAAA,CAAAN,CAAA,EAAAD,CAAA,iBAAAJ,CAAA;AAAA,SAAAmB,gBAAAnB,CAAA,EAAAI,CAAA,EAAAC,CAAA,YAAAD,CAAA,GAAAmB,cAAA,CAAAnB,CAAA,MAAAJ,CAAA,GAAAM,MAAA,CAAAgB,cAAA,CAAAtB,CAAA,EAAAI,CAAA,IAAAoB,KAAA,EAAAnB,CAAA,EAAAO,UAAA,MAAAa,YAAA,MAAAC,QAAA,UAAA1B,CAAA,CAAAI,CAAA,IAAAC,CAAA,EAAAL,CAAA;AAAA,SAAAuB,eAAAlB,CAAA,QAAAsB,CAAA,GAAAC,YAAA,CAAAvB,CAAA,uCAAAsB,CAAA,GAAAA,CAAA,GAAAA,CAAA;AAAA,SAAAC,aAAAvB,CAAA,EAAAD,CAAA,2BAAAC,CAAA,KAAAA,CAAA,SAAAA,CAAA,MAAAL,CAAA,GAAAK,CAAA,CAAAwB,MAAA,CAAAC,WAAA,kBAAA9B,CAAA,QAAA2B,CAAA,GAAA3B,CAAA,CAAA+B,IAAA,CAAA1B,CAAA,EAAAD,CAAA,uCAAAuB,CAAA,SAAAA,CAAA,YAAAK,SAAA,yEAAA5B,CAAA,GAAA6B,MAAA,GAAAC,MAAA,EAAA7B,CAAA;AAE1E,MAAM8B,YAAY,GAAG,IAAI,GAAG,EAAE;AAC9B,MAAMC,QAAQ,GAAG,IAAAC,wBAAiB,EAACC,SAAS,EAAEH,YAAY,CAAC;AAC3D,MAAMI,MAAM,GAAG,IAAAC,SAAS,EAAC,MAAM,CAAC;AAEhC,MAAMC,OAAO,GAAG;EACdC,mBAAmB,EAAGC,WAAmB,IAAK;IAC5C,OAAOJ,MAAM,CAACK,WAAW,CAAEC,CAAC,IAC1BA,CAAC,CAACC,KAAK,CACLC,iBAAM,CAACC,GAAG,CACRD,iBAAM,CAACD,KAAK,CAAC,aAAa,EAAE,IAAI,EAAEH,WAAW,CAAC,EAC9CI,iBAAM,CAACD,KAAK,CAAC,WAAW,EAAE,IAAI,EAAE,IAAI,CACtC,CACF,CACF,CAAC;EACH,CAAC;EACDG,WAAW,EAAGC,GAAa,IAAK;IAC9B,OAAOX,MAAM,CAACK,WAAW,CAAEC,CAAC,IAAKA,CAAC,CAACC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAEI,GAAG,CAAC,CAAC;EAC5D,CAAC;EACDC,MAAM,EAAEA,CAAA,KAAM;IACZ,OAAOZ,MAAM,CAACK,WAAW,CAAEC,CAAC,IAAKA,CAAC,CAACC,KAAK,CAAC,WAAW,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;EACpE,CAAC;EACDM,eAAe,EAAEA,CAAA,KAAM;IACrB,OAAOb,MAAM,CAACK,WAAW,CAAEC,CAAC,IAC1BA,CAAC,CAACC,KAAK,CACLC,iBAAM,CAACC,GAAG,CACRD,iBAAM,CAACD,KAAK,CAAC,WAAW,EAAE,IAAI,EAAE,IAAI,CAAC,EACrCC,iBAAM,CAACD,KAAK,CAAC,WAAW,EAAE,IAAI,EAAE,IAAI,CACtC,CACF,CACF,CAAC;EACH,CAAC;EACDO,WAAW,EAAGC,MAAc,IAAK;IAC/B,OAAOf,MAAM,CACVK,WAAW,CAAEC,CAAC,IAAKA,CAAC,CAACC,KAAK,CAAC,QAAQ,EAAE,IAAI,EAAEQ,MAAM,CAAC,CAAC,CACnDR,KAAK,CAAC,WAAW,EAAE,IAAI,EAAE,IAAI,CAAC;EACnC;AACF,CAAC;AAED,MAAMS,WAAW,GAAGA,CAAA,KAAM;EACxB,MAAMC,UAAU,GAAG,MAAAA,CAAO;IACxBC,IAAI;IACJd,WAAW;IACXe,IAAI;IACJC,GAAG;IACHC,MAAM;IACNC;EAQF,CAAC,KAAK;IACJzB,QAAQ,CAAC0B,UAAU,CAAC,cAAcnB,WAAW,EAAE,CAAC,CAAC,CAAC;;IAElD,MAAMoB,aAAa,GAAG,MAAMC,mBAAmB,CAACrB,WAAW,CAAC;IAC5D,IAAI,CAACoB,aAAa,EAAE;MAClB,MAAME,QAAQ,GAAG,MAAMC,oBAAoB,CAACvB,WAAW,CAAC;MACxD,MAAMwB,UAAU,CAACF,QAAQ,CAACG,EAAE,EAAE;QAC5BP,SAAS,EAAE,IAAI;QACfJ,IAAI;QACJC,IAAI;QACJE,MAAM,EAAEA,MAAM,IAAI;MACpB,CAAC,CAAC;MACF,OAAO,IAAAS,yCAAgB,EAACC,qCAAY,CAACC,cAAc,CAAC;IACtD;IAEA,MAAMH,EAAE,GAAG,GAAGX,IAAI,IAAIe,MAAM,CAACC,UAAU,CAAC,CAAC,EAAE;IAC3C,MAAMC,QAAkC,GAAG;MACzCjB,IAAI;MACJd,WAAW;MACXe,IAAI;MACJC,GAAG;MACHE,SAAS,EAAEc,OAAO,CAACd,SAAS,CAAC;MAC7Be,cAAc,EAAE,EAAE;MAClBC,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC;MACrBC,SAAS,EAAEF,IAAI,CAACC,GAAG,CAAC,CAAC;MACrBE,SAAS,EAAE,IAAI;MACfC,YAAY,EAAE,IAAI;MAClBC,UAAU,EAAE,IAAI;MAChBC,GAAG,EAAE,IAAI;MACTxB,MAAM,EAAEA,MAAM,IAAI;IACpB,CAAC;IAED,MAAMrB,MAAM,CAAC8C,YAAY,CAACjB,EAAE,EAAEM,QAAQ,CAAC;IAEvC,OAAO,IAAAY,2CAAkB,EAAC;MAAElB;IAAG,CAAC,CAAC;EACnC,CAAC;EAED,MAAMmB,4BAA4B,GAAG,MAAAA,CAAO;IAC1C9B,IAAI;IACJd,WAAW;IACXe,IAAI;IACJC,GAAG;IACHC,MAAM;IACNC;EAQF,CAAC,KAAK;IACJ,MAAME,aAAa,GAAG,MAAMC,mBAAmB,CAACrB,WAAW,CAAC;IAC5D,IAAI,CAACoB,aAAa,EAAE;MAClB,OAAO,IAAAM,yCAAgB,EAACC,qCAAY,CAACC,cAAc,CAAC;IACtD;IAEA,MAAMH,EAAE,GAAG,GAAGX,IAAI,IAAIe,MAAM,CAACC,UAAU,CAAC,CAAC,EAAE;IAC3C,MAAMC,QAAkC,GAAG;MACzCjB,IAAI;MACJd,WAAW;MACXe,IAAI;MACJC,GAAG;MACHE,SAAS,EAAEc,OAAO,CAACd,SAAS,CAAC;MAC7Be,cAAc,EAAE,EAAE;MAClBC,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC;MACrBC,SAAS,EAAEF,IAAI,CAACC,GAAG,CAAC,CAAC;MACrBE,SAAS,EAAE,IAAI;MACfC,YAAY,EAAE,IAAI;MAClBC,UAAU,EAAE,IAAI;MAChBC,GAAG,EAAE,IAAI;MACTxB,MAAM,EAAEA,MAAM,IAAI;IACpB,CAAC;IAED,MAAMrB,MAAM,CAAC8C,YAAY,CAACjB,EAAE,EAAEM,QAAQ,CAAC;IACvC,OAAO,IAAAY,2CAAkB,EAAC;MAAElB;IAAG,CAAC,CAAC;EACnC,CAAC;EAED,MAAMoB,UAAU,GAAG,MAAOC,IAA6B,IAAK;IAC1D,IAAIA,IAAI,CAACrB,EAAE,EAAE;MACXhC,QAAQ,CAAC0B,UAAU,CAAC2B,IAAI,CAACrB,EAAE,CAAC;MAE5B,OAAOD,UAAU,CAACsB,IAAI,CAACrB,EAAE,EAAArD,aAAA,KACpB0E,IAAI,CACR,CAAC;IACJ,CAAC,MAAM;MACL,MAAM;QAAEhC,IAAI;QAAEd,WAAW;QAAEe;MAAK,CAAC,GAAG+B,IAAI;MACxC,IAAI,CAAChC,IAAI,IAAI,CAACd,WAAW,IAAI,CAACe,IAAI,EAAE;QAClC,OAAO,IAAAW,yCAAgB,EAACC,qCAAY,CAACoB,aAAa,CAAC;MACrD;MAEA,OAAOlC,UAAU,CAAC;QAChBE,IAAI;QACJG,SAAS,EAAE,IAAI;QACflB,WAAW;QACXc,IAAI;QACJG,MAAM,EAAE6B,IAAI,CAAC7B,MAAM,IAAI,UAAU;QACjCD,GAAG,EAAE8B,IAAI,CAAC9B,GAAG,IAAI;MACnB,CAAC,CAAC;IACJ;EACF,CAAC;EAED,MAAMgC,WAAW,GAAG,MAAO9B,SAAmB,IAAK;IACjD,MAAM4B,IAAI,GAAG,MAAMlD,MAAM,CAACqD,QAAQ,CAChC/B,SAAS,GAAGpB,OAAO,CAACW,eAAe,CAAC,CAAC,GAAGX,OAAO,CAACU,MAAM,CAAC,CACzD,CAAC;IACD,OAAOsC,IAAI;EACb,CAAC;EAED,MAAMtB,UAAU,GAAG,MAAAA,CACjBC,EAAU,EACVqB,IAAkD,KAC/C;IACHrD,QAAQ,CAAC0B,UAAU,CAACM,EAAE,CAAC;IACvB,MAAMyB,UAAU,GAAG,MAAMC,gBAAgB,CAAC1B,EAAE,CAAC;IAE7C,IAAI,CAACyB,UAAU,EAAE;MACf,OAAO,IAAAxB,yCAAgB,EAACC,qCAAY,CAACyB,SAAS,CAAC;IACjD;IAEA,MAAMxD,MAAM,CAAC8C,YAAY,CAACjB,EAAE,EAAArD,aAAA,CAAAA,aAAA,KACvB0E,IAAI;MACPT,SAAS,EAAEF,IAAI,CAACC,GAAG,CAAC;IAAC,EACtB,CAAC;IAEF,OAAO,IAAAO,2CAAkB,EAAC,MAAMU,WAAW,CAAC5B,EAAE,CAAC,CAAC;EAClD,CAAC;EAED,MAAM4B,WAAW,GAAI5B,EAAU,IAA8B;IAC3D,OAAOhC,QAAQ,CACZ6D,OAAO,CAAC7B,EAAE,EAAE,MAAM7B,MAAM,CAAC2D,UAAU,CAAC9B,EAAE,CAAC,CAAC,CACxC+B,IAAI,CAAEC,GAAG,IAAKA,GAAG,CAACX,IAAI,CAAC;EAC5B,CAAC;EAED,MAAMY,UAAU,GAAIjC,EAAU,IAAK;IACjChC,QAAQ,CAAC0B,UAAU,CAACM,EAAE,CAAC;IACvB,OAAO7B,MAAM,CAAC8C,YAAY,CAACjB,EAAE,EAAE;MAAEa,SAAS,EAAEH,IAAI,CAACC,GAAG,CAAC;IAAE,CAAC,CAAC;EAC3D,CAAC;EAED,MAAMuB,cAAc,GAAIlC,EAAU,IAAK;IACrChC,QAAQ,CAAC0B,UAAU,CAACM,EAAE,CAAC;IACvB,OAAO7B,MAAM,CAACgE,YAAY,CAACnC,EAAE,CAAC;EAChC,CAAC;EAED,MAAM0B,gBAAgB,GAAG,MAAO1B,EAAU,IAAuB;IAC/D,MAAMoC,MAAM,GAAG,MAAMpE,QAAQ,CAC1B6D,OAAO,CAAC,UAAU7B,EAAE,EAAE,EAAE,MAAM7B,MAAM,CAACkE,YAAY,CAACrC,EAAE,CAAC,CAAC,CACtD+B,IAAI,CAAEC,GAAG,IAAKA,GAAG,CAACX,IAAI,CAAC;IAE1B,OAAOe,MAAM;EACf,CAAC;EAED,MAAMxC,mBAAmB,GAAG,MAAOrB,WAAmB,IAAuB;IAC3E,MAAM+D,OAAyB,GAAG,MAAMtE,QAAQ,CAC7C6D,OAAO,CAAC,cAActD,WAAW,EAAE,EAAE,MACpCJ,MAAM,CAACqD,QAAQ,CAACnD,OAAO,CAACC,mBAAmB,CAACC,WAAW,CAAC,CAC1D,CAAC,CACAwD,IAAI,CAAEC,GAAG,IAAKA,GAAG,CAACX,IAAI,CAAC;IAE1B,OAAOiB,OAAO,CAACzF,MAAM,KAAK,CAAC;EAC7B,CAAC;EAED,MAAMiD,oBAAoB,GAAG,MAAOvB,WAAmB,IAAK;IAC1D,MAAM+D,OAAyB,GAAG,MAAMnE,MAAM,CAACqD,QAAQ,CACrDnD,OAAO,CAACC,mBAAmB,CAACC,WAAW,CACzC,CAAC;IAED,OAAO+D,OAAO,CAAC,CAAC,CAAC;EACnB,CAAC;EAED,MAAMC,iBAAiB,GAAG,MAAAA,CAAOC,MAAc,EAAEC,OAAe,KAAK;IACnE,MAAMhB,UAAU,GAAG,MAAMC,gBAAgB,CAACc,MAAM,CAAC;IACjD,IAAI,CAACf,UAAU,EAAE,OAAO,IAAAxB,yCAAgB,EAACC,qCAAY,CAACyB,SAAS,CAAC;IAEhE,MAAMe,WAAW,GAAG,MAAMC,yBAAgB,CAACC,iBAAiB,CAACH,OAAO,CAAC;IACrE,IAAI,CAACC,WAAW,EAAE,OAAO,IAAAzC,yCAAgB,EAACC,qCAAY,CAACyB,SAAS,CAAC;IAEjE5B,UAAU,CAACyC,MAAM,EAAE;MACjBhC,cAAc,EAAEqC,qBAAU,CAACC,UAAU,CAACL,OAAO;IAC/C,CAAC,CAAC;IAEFE,yBAAgB,CAACI,WAAW,CAACN,OAAO,EAAE;MACpCO,SAAS,EAAEH,qBAAU,CAACC,UAAU,CAACN,MAAM;IACzC,CAAC,CAAC;IAEF,OAAO,IAAAtB,2CAAkB,EAAC;MAAE+B,OAAO,EAAE;IAAK,CAAC,CAAC;EAC9C,CAAC;EAED,MAAMC,qBAAqB,GAAG,MAAAA,CAAOV,MAAc,EAAEC,OAAe,KAAK;IACvE,MAAMhB,UAAU,GAAG,MAAMC,gBAAgB,CAACc,MAAM,CAAC;IACjD,IAAI,CAACf,UAAU,EAAE,OAAO,IAAAxB,yCAAgB,EAACC,qCAAY,CAACyB,SAAS,CAAC;IAEhE,MAAMe,WAAW,GAAG,MAAMC,yBAAgB,CAACC,iBAAiB,CAACH,OAAO,CAAC;IACrE,IAAI,CAACC,WAAW,EAAE,OAAO,IAAAzC,yCAAgB,EAACC,qCAAY,CAACyB,SAAS,CAAC;IAEjEgB,yBAAgB,CAACI,WAAW,CAACN,OAAO,EAAE;MACpCU,UAAU,EAAEN,qBAAU,CAACC,UAAU,CAACN,MAAM,CAAC;MACzCY,OAAO,EAAEP,qBAAU,CAACC,UAAU,CAACN,MAAM;IACvC,CAAC,CAAC;IAEF,OAAO,IAAAtB,2CAAkB,EAAC;MAAE+B,OAAO,EAAE;IAAK,CAAC,CAAC;EAC9C,CAAC;EAED,MAAMI,kBAAkB,GAAG,MAAAA,CAAOb,MAAc,EAAEC,OAAe,KAAK;IACpE,MAAMhB,UAAU,GAAG,MAAMC,gBAAgB,CAACc,MAAM,CAAC;IACjD,IAAI,CAACf,UAAU,EAAE,OAAO,IAAAxB,yCAAgB,EAACC,qCAAY,CAACyB,SAAS,CAAC;IAEhE,MAAMe,WAAW,GAAG,MAAMC,yBAAgB,CAACC,iBAAiB,CAACH,OAAO,CAAC;IACrE,IAAI,CAACC,WAAW,EAAE,OAAO,IAAAzC,yCAAgB,EAACC,qCAAY,CAACyB,SAAS,CAAC;IAEjEgB,yBAAgB,CAACI,WAAW,CAACN,OAAO,EAAE;MACpCW,OAAO,EAAEP,qBAAU,CAACC,UAAU,CAACN,MAAM;IACvC,CAAC,CAAC;IAEF,OAAO,IAAAtB,2CAAkB,EAAC;MAAE+B,OAAO,EAAE;IAAK,CAAC,CAAC;EAC9C,CAAC;EAED,MAAMK,aAAa,GAAG,MAAOxE,GAAa,IAAK;IAC7C,MAAMyE,KAAK,GAAG,MAAMpF,MAAM,CAACqD,QAAQ,CAACnD,OAAO,CAACQ,WAAW,CAACC,GAAG,CAAC,CAAC;IAC7D,OAAOyE,KAAK;EACd,CAAC;EAED,MAAMC,aAAa,GAAG,MAAO/D,SAAkB,IAAK;IAClD,MAAMgE,WAAW,GAAG,MAAMtF,MAAM,CAACuF,YAAY,CAC3CjE,SAAS,GAAGpB,OAAO,CAACW,eAAe,CAAC,CAAC,GAAGX,OAAO,CAACU,MAAM,CAAC,CACzD,CAAC;IACD,OAAO,IAAAmC,2CAAkB,EAAC;MAAEyC,MAAM,EAAEF;IAAY,CAAC,CAAC;EACpD,CAAC;EAED,MAAMG,sBAAsB,GAAG,MAAAA,CAAOpB,MAAc,EAAEC,OAAe,KAAK;IACxE,MAAMhB,UAAU,GAAG,MAAMC,gBAAgB,CAACc,MAAM,CAAC;IACjD,IAAI,CAACf,UAAU,EAAE,OAAO,IAAAxB,yCAAgB,EAACC,qCAAY,CAACyB,SAAS,CAAC;IAEhE,MAAMe,WAAW,GAAG,MAAMC,yBAAgB,CAACC,iBAAiB,CAACH,OAAO,CAAC;IACrE,IAAI,CAACC,WAAW,EAAE,OAAO,IAAAzC,yCAAgB,EAACC,qCAAY,CAACyB,SAAS,CAAC;IAEjE,OAAO,IAAAT,2CAAkB,EACvB2C,4CAA6B,CAACC,OAAO,CAAC;MACpCC,MAAM,EAAE,SAAS;MACjBtB,OAAO;MACPD;IACF,CAAC,CACH,CAAC;EACH,CAAC;EAED,MAAMwB,gBAAgB,GAAI9E,MAAc,IAAK;IAC3C,OAAOf,MAAM,CAACqD,QAAQ,CAACnD,OAAO,CAACY,WAAW,CAACC,MAAM,CAAC,CAAC;EACrD,CAAC;EAED,OAAO;IACLE,UAAU;IACVmC,WAAW;IACXxB,UAAU;IACV6B,WAAW;IACX9B,oBAAoB;IACpBmC,UAAU;IACVC,cAAc;IACdR,gBAAgB;IAChB4B,aAAa;IACb1D,mBAAmB;IACnB2C,iBAAiB;IACjBnB,UAAU;IACVD,4BAA4B;IAC5B6C,gBAAgB;IAChBd,qBAAqB;IACrBG,kBAAkB;IAClBG,aAAa;IACbI;EACF,CAAC;AACH,CAAC;AAAC,IAAAK,QAAA,GAAAC,OAAA,CAAApI,OAAA,GAEaqD,WAAW,CAAC,CAAC","ignoreList":[]}