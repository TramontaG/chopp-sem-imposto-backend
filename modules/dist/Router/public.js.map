{"version":3,"file":"public.js","names":["_express","require","_SafeRequest","_bucketStorage","_mimeTypes","_interopRequireDefault","e","__esModule","default","publicRouter","Router","get","safeRequest","req","res","fileId","params","src","event","file","downloadFile","setHeader","mime","lookup","send","_default","exports"],"sources":["../../src/Router/public.ts"],"sourcesContent":["import { Router } from \"express\";\nimport { safeRequest } from \"../Util/SafeRequest\";\nimport { downloadFile } from \"../CDN/bucketStorage\";\nimport mime from \"mime-types\";\n\nconst publicRouter = Router();\n\npublicRouter.get(\n  \"/:src/:event/:file\",\n  safeRequest(async (req, res) => {\n    const fileId = `${req.params.src}/${req.params.event}/${req.params.file}`;\n    const file = await downloadFile(fileId);\n\n    return (\n      res\n        .setHeader(\n          \"Content-Type\",\n          mime.lookup(req.params.file) || \"application/octet-steam\"\n        )\n        // avoids cacheing the result on cloudflare reverse proxy\n        .setHeader(\"X-Content-Type-Options\", \"nosniff\")\n        .send(file)\n    );\n  })\n);\n\nexport default publicRouter;\n"],"mappings":";;;;;;AAAA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,YAAA,GAAAD,OAAA;AACA,IAAAE,cAAA,GAAAF,OAAA;AACA,IAAAG,UAAA,GAAAC,sBAAA,CAAAJ,OAAA;AAA8B,SAAAI,uBAAAC,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAE9B,MAAMG,YAAY,GAAG,IAAAC,eAAM,EAAC,CAAC;AAE7BD,YAAY,CAACE,GAAG,CACd,oBAAoB,EACpB,IAAAC,wBAAW,EAAC,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC9B,MAAMC,MAAM,GAAG,GAAGF,GAAG,CAACG,MAAM,CAACC,GAAG,IAAIJ,GAAG,CAACG,MAAM,CAACE,KAAK,IAAIL,GAAG,CAACG,MAAM,CAACG,IAAI,EAAE;EACzE,MAAMA,IAAI,GAAG,MAAM,IAAAC,2BAAY,EAACL,MAAM,CAAC;EAEvC,OACED,GAAG,CACAO,SAAS,CACR,cAAc,EACdC,kBAAI,CAACC,MAAM,CAACV,GAAG,CAACG,MAAM,CAACG,IAAI,CAAC,IAAI,yBAClC;EACA;EAAA,CACCE,SAAS,CAAC,wBAAwB,EAAE,SAAS,CAAC,CAC9CG,IAAI,CAACL,IAAI,CAAC;AAEjB,CAAC,CACH,CAAC;AAAC,IAAAM,QAAA,GAAAC,OAAA,CAAAlB,OAAA,GAEaC,YAAY","ignoreList":[]}