{"version":3,"file":"admin.js","names":["_express","require","_SafeRequest","V","_interopRequireWildcard","_adminsController","_interopRequireDefault","_JWT","_cookieParser","_SafeDatabaseTransaction","_sanitizeCity","_userController","_eventsController","_fs","_KozzModule","_phoneNumber","_sendInvite","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","adminRouter","Router","post","json","safeRequest","req","res","name","password","permissions","username","validate","string","array","body","result","adminsController","createAdmin","safeReturnTransaction","useJWT","ageBegin","ageEnd","city","eventId","limit","index","session","number","requestResult","fetch","headers","Cookie","ok","status","send","data","then","resp","message","userList","map","affiliate","ageAsNumber","Number","age","split","currYear","Date","getFullYear","birthYear","birthDate","phoneNumber","formatPhoneNumber","phone","DOB","getTime","source","confirmed","jids","Promise","all","user","userController","createUserAvoidingDuplicates","isTransactionSuccessful","phoneToJid","filter","Boolean","sendInviteToList","cookieParser","loginTransaction","login","jwt","generateJwt","userId","id","cookie","httpOnly","expires","now","sameSite","secure","suggestions","dryRunNormalizeCities","suggestion","updateUser","after","allUsers","getAllUsers","eventsController","updateEvent","invited","u","success","groupName","group","module","ask","boundary","response","find","transactionError","FAIL_REASONS","NOT_FOUND","participantsPhones","participants","p","createdUsersID","getUserByPhoneNumber","createUser","delete","origin","getEventById","getUsersByOrigin","userIdsToRemove","updatedInvitedList","includes","hardDeleteUser","JSON","parse","fs","readFileSync","encoding","event","phoneToUser","Map","nat","userPhoneToBrNational","length","invitedSet","Set","toInvite","seenUserIds","jidToBrNational","push","add","jidList","_default","exports"],"sources":["../../src/Router/admin.ts"],"sourcesContent":["import { Router, json, request, response } from \"express\";\nimport { safeRequest } from \"../Util/SafeRequest\";\nimport * as V from \"../Util/ZodValidation\";\nimport adminsController from \"../database/controllers/adminsController\";\nimport { generateJwt, useJWT } from \"../JWT\";\nimport cookieParser from \"cookie-parser\";\nimport {\n  FAIL_REASONS,\n  isTransactionSuccessful,\n  safeReturnTransaction,\n  transactionError,\n  type TransactionSuccess,\n} from \"../Util/SafeDatabaseTransaction\";\nimport { dryRunNormalizeCities } from \"../Util/sanitizeCity\";\nimport userController from \"../database/controllers/userController\";\nimport eventsController from \"../database/controllers/eventsController.\";\nimport fs from \"fs\";\nimport module from \"../Kozz-Module\";\nimport type { GroupChat, GroupChatData } from \"kozz-types\";\nimport {\n  formatPhoneNumber,\n  jidToBrNational,\n  phoneToJid,\n  userPhoneToBrNational,\n} from \"../Util/phoneNumber\";\nimport type { WithID } from \"../database/schemas\";\nimport { sendInviteToList } from \"../Kozz-Module/Methods/sendInvite\";\nimport UserRouter from \"./Users\";\n\nconst adminRouter = Router();\n\nadminRouter.post(\n  \"/create\",\n  // useJWT([\"create-account\"]),\n  json(),\n  safeRequest(async (req, res) => {\n    const { name, password, permissions, username } = V.validate(\n      {\n        username: V.string,\n        password: V.string,\n        permissions: V.array(V.string),\n        name: V.string,\n      },\n      req.body\n    );\n\n    const result = await adminsController.createAdmin({\n      name,\n      password,\n      permissions,\n      username,\n    });\n\n    return safeReturnTransaction(result);\n  })\n);\n\ntype Affiliate = {\n  id: number;\n  affiliatedId: string;\n  name: string;\n  state: string;\n  city: string;\n  disaffiliation: string;\n  age: string;\n  exemption: string;\n  filiation: string;\n  filiationSolicitation: string;\n  status: string;\n  phone: string;\n};\n\nadminRouter.post(\n  \"/invite_novo\",\n  useJWT([\"admin\"]),\n  safeRequest(async (req, res) => {\n    const { ageBegin, ageEnd, city, eventId, limit, index, session } =\n      V.validate(\n        {\n          ageBegin: V.number,\n          ageEnd: V.number,\n          city: V.number,\n          eventId: V.string,\n          limit: V.number,\n          index: V.number,\n          session: V.string,\n        },\n        req.body\n      );\n\n    const requestResult = await fetch(\n      `https://gestao.novo.org.br/api/filiados/json/?ageBegin=${ageBegin}&ageEnd=${ageEnd}&city=${city}&state2=26&status=7&ordination=ASC&limit=${limit}&index=${index}`,\n      {\n        headers: {\n          Cookie: \"PHPSESSID=\" + session,\n        },\n      }\n    );\n\n    if (!requestResult.ok) {\n      return res.status(requestResult.status).send(await requestResult.json());\n    }\n\n    const data = await requestResult\n      .json()\n      .then((resp: any) => resp.message as Affiliate[]);\n\n    const userList = data.map((affiliate) => {\n      const ageAsNumber = Number(affiliate.age.split(\" \")[0]);\n      const currYear = new Date().getFullYear();\n      const birthYear = currYear - ageAsNumber;\n      const birthDate = new Date(birthYear, 0, 1);\n\n      return {\n        name: affiliate.name,\n        phoneNumber: formatPhoneNumber(affiliate.phone),\n        city: affiliate.city,\n        DOB: birthDate.getTime(),\n        source: \"novo\" as WithID<\"user\">[\"source\"],\n        confirmed: false,\n      };\n    });\n\n    const jids = (\n      await Promise.all(\n        userList.map(async (user) => {\n          const result = await userController.createUserAvoidingDuplicates(\n            user\n          );\n          if (isTransactionSuccessful(result)) {\n            return phoneToJid(user.phoneNumber);\n          }\n        })\n      )\n    ).filter(Boolean) as string[];\n\n    sendInviteToList(jids, eventId);\n\n    return {\n      userList,\n      jids,\n    };\n  })\n);\n\nadminRouter.get(\n  \"/ok\",\n  useJWT([\"admin\"]),\n  safeRequest(async (req, res) => {\n    return { message: \"ok\" };\n  })\n);\n\nadminRouter.post(\n  \"/login\",\n  json(),\n  cookieParser(),\n  safeRequest(async (req, res) => {\n    const { username, password } = V.validate(\n      {\n        username: V.string,\n        password: V.string,\n      },\n      req.body\n    );\n\n    const loginTransaction = await adminsController.login(username, password);\n\n    if (!isTransactionSuccessful(loginTransaction)) {\n      return safeReturnTransaction(loginTransaction);\n    }\n\n    const result = loginTransaction.data;\n\n    const jwt = generateJwt({\n      userId: result.id,\n      username: result.name,\n    });\n\n    res.cookie(\"jwt\", jwt, {\n      httpOnly: true,\n\n      expires: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n      sameSite: \"none\",\n      secure: true,\n    });\n\n    return { jwt };\n  })\n);\n\nadminRouter.post(\"/sanitize-city\", async (req, res) => {\n  const suggestions = await dryRunNormalizeCities();\n\n  const result = await Promise.all(\n    suggestions.map((suggestion) => {\n      userController.updateUser(suggestion.id, {\n        city: suggestion.after,\n      });\n    })\n  );\n\n  res.send(result);\n});\n\nadminRouter.post(\n  \"/patch_event\",\n  useJWT([\"admin\"]),\n  json(),\n  safeRequest(async (req) => {\n    const { eventId } = V.validate({ eventId: V.string }, req.body);\n    const allUsers = await userController.getAllUsers();\n\n    await eventsController.updateEvent(eventId, {\n      invited: allUsers.map((u) => u.id),\n    });\n\n    return {\n      success: true,\n    };\n  })\n);\n\nadminRouter.post(\n  \"/add_from_group\",\n  useJWT([\"admin\"]),\n  json(),\n  safeRequest(async (req, res) => {\n    const { groupName } = V.validate(\n      {\n        groupName: V.string,\n      },\n      req.body\n    );\n\n    const group: GroupChat | undefined = (\n      await module.ask.boundary(\"iae-baileys\", \"all_groups\")\n    ).response.find((group: GroupChatData) => group.name === groupName);\n\n    if (!group) {\n      return transactionError(FAIL_REASONS.NOT_FOUND);\n    }\n\n    const participantsPhones = group.participants.map((p) =>\n      formatPhoneNumber(p.id)\n    );\n\n    const createdUsersID = await Promise.all(\n      participantsPhones.map(async (phone) => {\n        const user = await userController.getUserByPhoneNumber(phone);\n        if (!user) {\n          // return phone;\n\n          return await userController.createUser({\n            phoneNumber: phone,\n            city: \"no_city\",\n            confirmed: false,\n            DOB: null,\n            name: \"no_name\",\n            source: `whatsapp-${groupName}`,\n          });\n        }\n      })\n    );\n\n    return { createdUsersID };\n  })\n);\n\nadminRouter.delete(\n  \"/from_group\",\n  useJWT([\"admin\"]),\n  safeRequest(async (req) => {\n    const { groupName, eventId } = V.validate(\n      {\n        groupName: V.string,\n        eventId: V.string,\n      },\n      req.body\n    );\n\n    const origin = `${groupName}`;\n\n    const { invited } = await eventsController.getEventById(eventId);\n\n    const allUsers = await userController.getUsersByOrigin(origin);\n\n    const userIdsToRemove = allUsers.map((user) => user.id);\n\n    const updatedInvitedList = invited.filter(\n      (id) => !userIdsToRemove.includes(id)\n    );\n\n    await eventsController.updateEvent(eventId, {\n      invited: updatedInvitedList,\n    });\n\n    const result = await Promise.all(\n      allUsers.map((user) => {\n        return userController.hardDeleteUser(user.id);\n      })\n    );\n\n    return {\n      userIdsToRemove,\n      updatedInvitedList,\n    };\n  })\n);\n\nadminRouter.post(\n  \"/send_to_group\",\n  useJWT([\"admin\"]),\n  json(),\n  safeRequest(async (req, res) => {\n    const { groupName, eventId } = V.validate(\n      {\n        groupName: V.string,\n        eventId: V.string,\n      },\n      req.body\n    );\n\n    const group: GroupChat | undefined = JSON.parse(\n      fs.readFileSync(\"src/temp.json\", { encoding: \"utf-8\" })\n    );\n\n    if (!group) {\n      return transactionError(FAIL_REASONS.NOT_FOUND);\n    }\n\n    const event = await eventsController.getEventById(eventId);\n\n    if (!event) {\n      return transactionError(FAIL_REASONS.NOT_FOUND);\n    }\n\n    const allUsers = await userController.getUsersByOrigin(\n      `whatsapp-${groupName}`\n    );\n\n    const phoneToUser = new Map<string, WithID<\"user\">>();\n    for (const u of allUsers) {\n      const nat = userPhoneToBrNational(u.phoneNumber);\n      if (nat.length === 10 || nat.length === 11) {\n        if (!phoneToUser.has(nat)) phoneToUser.set(nat, u);\n      }\n    }\n\n    const invitedSet = new Set(event.invited ?? []);\n    const toInvite: WithID<\"user\">[] = [];\n    const seenUserIds = new Set<string>();\n\n    for (const p of group.participants) {\n      const nat = jidToBrNational(p.id);\n      if (!nat) continue; // ignora JIDs fora do padrão BR\n      const user = phoneToUser.get(nat);\n      if (!user) continue; // participante não cadastrado no banco\n      if (invitedSet.has(user.id)) continue; // já convidado\n      if (seenUserIds.has(user.id)) continue; // evita duplicata no mesmo run\n\n      toInvite.push(user);\n      seenUserIds.add(user.id);\n    }\n\n    await eventsController.updateEvent(event.id, {\n      invited: [...event.invited, ...toInvite.map((u) => u.id)],\n    });\n\n    const jidList = toInvite.map((u) => phoneToJid(u.phoneNumber));\n\n    sendInviteToList(jidList, event.id, group.name);\n\n    return {\n      success: true,\n      data: jidList,\n    };\n  })\n);\n\nadminRouter.get(\n  \"/group_list\",\n  useJWT([\"admin\"]),\n  json(),\n  safeRequest(async (req, res) => {\n    const group: GroupChat[] = (\n      await module.ask.boundary(\"iae-baileys\", \"all_groups\")\n    ).response;\n\n    return group;\n  })\n);\n\nexport default adminRouter;\n"],"mappings":";;;;;;AAAA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,YAAA,GAAAD,OAAA;AACA,IAAAE,CAAA,GAAAC,uBAAA,CAAAH,OAAA;AACA,IAAAI,iBAAA,GAAAC,sBAAA,CAAAL,OAAA;AACA,IAAAM,IAAA,GAAAN,OAAA;AACA,IAAAO,aAAA,GAAAF,sBAAA,CAAAL,OAAA;AACA,IAAAQ,wBAAA,GAAAR,OAAA;AAOA,IAAAS,aAAA,GAAAT,OAAA;AACA,IAAAU,eAAA,GAAAL,sBAAA,CAAAL,OAAA;AACA,IAAAW,iBAAA,GAAAN,sBAAA,CAAAL,OAAA;AACA,IAAAY,GAAA,GAAAP,sBAAA,CAAAL,OAAA;AACA,IAAAa,WAAA,GAAAR,sBAAA,CAAAL,OAAA;AAEA,IAAAc,YAAA,GAAAd,OAAA;AAOA,IAAAe,WAAA,GAAAf,OAAA;AAAqE,SAAAK,uBAAAW,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAAA,SAAAb,wBAAAa,CAAA,EAAAG,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAjB,uBAAA,YAAAA,CAAAa,CAAA,EAAAG,CAAA,SAAAA,CAAA,IAAAH,CAAA,IAAAA,CAAA,CAAAC,UAAA,SAAAD,CAAA,MAAAO,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,QAAAR,OAAA,EAAAF,CAAA,iBAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,SAAAS,CAAA,MAAAF,CAAA,GAAAJ,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAE,CAAA,CAAAI,GAAA,CAAAX,CAAA,UAAAO,CAAA,CAAAK,GAAA,CAAAZ,CAAA,GAAAO,CAAA,CAAAM,GAAA,CAAAb,CAAA,EAAAS,CAAA,gBAAAN,CAAA,IAAAH,CAAA,gBAAAG,CAAA,OAAAW,cAAA,CAAAC,IAAA,CAAAf,CAAA,EAAAG,CAAA,OAAAK,CAAA,IAAAD,CAAA,GAAAS,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAlB,CAAA,EAAAG,CAAA,OAAAK,CAAA,CAAAI,GAAA,IAAAJ,CAAA,CAAAK,GAAA,IAAAN,CAAA,CAAAE,CAAA,EAAAN,CAAA,EAAAK,CAAA,IAAAC,CAAA,CAAAN,CAAA,IAAAH,CAAA,CAAAG,CAAA,WAAAM,CAAA,KAAAT,CAAA,EAAAG,CAAA;AAGrE,MAAMgB,WAAW,GAAG,IAAAC,eAAM,EAAC,CAAC;AAE5BD,WAAW,CAACE,IAAI,CACd,SAAS;AACT;AACA,IAAAC,aAAI,EAAC,CAAC,EACN,IAAAC,wBAAW,EAAC,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC9B,MAAM;IAAEC,IAAI;IAAEC,QAAQ;IAAEC,WAAW;IAAEC;EAAS,CAAC,GAAG3C,CAAC,CAAC4C,QAAQ,CAC1D;IACED,QAAQ,EAAE3C,CAAC,CAAC6C,MAAM;IAClBJ,QAAQ,EAAEzC,CAAC,CAAC6C,MAAM;IAClBH,WAAW,EAAE1C,CAAC,CAAC8C,KAAK,CAAC9C,CAAC,CAAC6C,MAAM,CAAC;IAC9BL,IAAI,EAAExC,CAAC,CAAC6C;EACV,CAAC,EACDP,GAAG,CAACS,IACN,CAAC;EAED,MAAMC,MAAM,GAAG,MAAMC,yBAAgB,CAACC,WAAW,CAAC;IAChDV,IAAI;IACJC,QAAQ;IACRC,WAAW;IACXC;EACF,CAAC,CAAC;EAEF,OAAO,IAAAQ,8CAAqB,EAACH,MAAM,CAAC;AACtC,CAAC,CACH,CAAC;AAiBDf,WAAW,CAACE,IAAI,CACd,cAAc,EACd,IAAAiB,WAAM,EAAC,CAAC,OAAO,CAAC,CAAC,EACjB,IAAAf,wBAAW,EAAC,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC9B,MAAM;IAAEc,QAAQ;IAAEC,MAAM;IAAEC,IAAI;IAAEC,OAAO;IAAEC,KAAK;IAAEC,KAAK;IAAEC;EAAQ,CAAC,GAC9D3D,CAAC,CAAC4C,QAAQ,CACR;IACES,QAAQ,EAAErD,CAAC,CAAC4D,MAAM;IAClBN,MAAM,EAAEtD,CAAC,CAAC4D,MAAM;IAChBL,IAAI,EAAEvD,CAAC,CAAC4D,MAAM;IACdJ,OAAO,EAAExD,CAAC,CAAC6C,MAAM;IACjBY,KAAK,EAAEzD,CAAC,CAAC4D,MAAM;IACfF,KAAK,EAAE1D,CAAC,CAAC4D,MAAM;IACfD,OAAO,EAAE3D,CAAC,CAAC6C;EACb,CAAC,EACDP,GAAG,CAACS,IACN,CAAC;EAEH,MAAMc,aAAa,GAAG,MAAMC,KAAK,CAC/B,0DAA0DT,QAAQ,WAAWC,MAAM,SAASC,IAAI,4CAA4CE,KAAK,UAAUC,KAAK,EAAE,EAClK;IACEK,OAAO,EAAE;MACPC,MAAM,EAAE,YAAY,GAAGL;IACzB;EACF,CACF,CAAC;EAED,IAAI,CAACE,aAAa,CAACI,EAAE,EAAE;IACrB,OAAO1B,GAAG,CAAC2B,MAAM,CAACL,aAAa,CAACK,MAAM,CAAC,CAACC,IAAI,CAAC,MAAMN,aAAa,CAACzB,IAAI,CAAC,CAAC,CAAC;EAC1E;EAEA,MAAMgC,IAAI,GAAG,MAAMP,aAAa,CAC7BzB,IAAI,CAAC,CAAC,CACNiC,IAAI,CAAEC,IAAS,IAAKA,IAAI,CAACC,OAAsB,CAAC;EAEnD,MAAMC,QAAQ,GAAGJ,IAAI,CAACK,GAAG,CAAEC,SAAS,IAAK;IACvC,MAAMC,WAAW,GAAGC,MAAM,CAACF,SAAS,CAACG,GAAG,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IACvD,MAAMC,QAAQ,GAAG,IAAIC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;IACzC,MAAMC,SAAS,GAAGH,QAAQ,GAAGJ,WAAW;IACxC,MAAMQ,SAAS,GAAG,IAAIH,IAAI,CAACE,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC;IAE3C,OAAO;MACL1C,IAAI,EAAEkC,SAAS,CAAClC,IAAI;MACpB4C,WAAW,EAAE,IAAAC,8BAAiB,EAACX,SAAS,CAACY,KAAK,CAAC;MAC/C/B,IAAI,EAAEmB,SAAS,CAACnB,IAAI;MACpBgC,GAAG,EAAEJ,SAAS,CAACK,OAAO,CAAC,CAAC;MACxBC,MAAM,EAAE,MAAkC;MAC1CC,SAAS,EAAE;IACb,CAAC;EACH,CAAC,CAAC;EAEF,MAAMC,IAAI,GAAG,CACX,MAAMC,OAAO,CAACC,GAAG,CACfrB,QAAQ,CAACC,GAAG,CAAC,MAAOqB,IAAI,IAAK;IAC3B,MAAM9C,MAAM,GAAG,MAAM+C,uBAAc,CAACC,4BAA4B,CAC9DF,IACF,CAAC;IACD,IAAI,IAAAG,gDAAuB,EAACjD,MAAM,CAAC,EAAE;MACnC,OAAO,IAAAkD,uBAAU,EAACJ,IAAI,CAACV,WAAW,CAAC;IACrC;EACF,CAAC,CACH,CAAC,EACDe,MAAM,CAACC,OAAO,CAAa;EAE7B,IAAAC,4BAAgB,EAACV,IAAI,EAAEnC,OAAO,CAAC;EAE/B,OAAO;IACLgB,QAAQ;IACRmB;EACF,CAAC;AACH,CAAC,CACH,CAAC;AAED1D,WAAW,CAACP,GAAG,CACb,KAAK,EACL,IAAA0B,WAAM,EAAC,CAAC,OAAO,CAAC,CAAC,EACjB,IAAAf,wBAAW,EAAC,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC9B,OAAO;IAAEgC,OAAO,EAAE;EAAK,CAAC;AAC1B,CAAC,CACH,CAAC;AAEDtC,WAAW,CAACE,IAAI,CACd,QAAQ,EACR,IAAAC,aAAI,EAAC,CAAC,EACN,IAAAkE,qBAAY,EAAC,CAAC,EACd,IAAAjE,wBAAW,EAAC,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC9B,MAAM;IAAEI,QAAQ;IAAEF;EAAS,CAAC,GAAGzC,CAAC,CAAC4C,QAAQ,CACvC;IACED,QAAQ,EAAE3C,CAAC,CAAC6C,MAAM;IAClBJ,QAAQ,EAAEzC,CAAC,CAAC6C;EACd,CAAC,EACDP,GAAG,CAACS,IACN,CAAC;EAED,MAAMwD,gBAAgB,GAAG,MAAMtD,yBAAgB,CAACuD,KAAK,CAAC7D,QAAQ,EAAEF,QAAQ,CAAC;EAEzE,IAAI,CAAC,IAAAwD,gDAAuB,EAACM,gBAAgB,CAAC,EAAE;IAC9C,OAAO,IAAApD,8CAAqB,EAACoD,gBAAgB,CAAC;EAChD;EAEA,MAAMvD,MAAM,GAAGuD,gBAAgB,CAACnC,IAAI;EAEpC,MAAMqC,GAAG,GAAG,IAAAC,gBAAW,EAAC;IACtBC,MAAM,EAAE3D,MAAM,CAAC4D,EAAE;IACjBjE,QAAQ,EAAEK,MAAM,CAACR;EACnB,CAAC,CAAC;EAEFD,GAAG,CAACsE,MAAM,CAAC,KAAK,EAAEJ,GAAG,EAAE;IACrBK,QAAQ,EAAE,IAAI;IAEdC,OAAO,EAAE,IAAI/B,IAAI,CAACA,IAAI,CAACgC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;IACxDC,QAAQ,EAAE,MAAM;IAChBC,MAAM,EAAE;EACV,CAAC,CAAC;EAEF,OAAO;IAAET;EAAI,CAAC;AAChB,CAAC,CACH,CAAC;AAEDxE,WAAW,CAACE,IAAI,CAAC,gBAAgB,EAAE,OAAOG,GAAG,EAAEC,GAAG,KAAK;EACrD,MAAM4E,WAAW,GAAG,MAAM,IAAAC,mCAAqB,EAAC,CAAC;EAEjD,MAAMpE,MAAM,GAAG,MAAM4C,OAAO,CAACC,GAAG,CAC9BsB,WAAW,CAAC1C,GAAG,CAAE4C,UAAU,IAAK;IAC9BtB,uBAAc,CAACuB,UAAU,CAACD,UAAU,CAACT,EAAE,EAAE;MACvCrD,IAAI,EAAE8D,UAAU,CAACE;IACnB,CAAC,CAAC;EACJ,CAAC,CACH,CAAC;EAEDhF,GAAG,CAAC4B,IAAI,CAACnB,MAAM,CAAC;AAClB,CAAC,CAAC;AAEFf,WAAW,CAACE,IAAI,CACd,cAAc,EACd,IAAAiB,WAAM,EAAC,CAAC,OAAO,CAAC,CAAC,EACjB,IAAAhB,aAAI,EAAC,CAAC,EACN,IAAAC,wBAAW,EAAC,MAAOC,GAAG,IAAK;EACzB,MAAM;IAAEkB;EAAQ,CAAC,GAAGxD,CAAC,CAAC4C,QAAQ,CAAC;IAAEY,OAAO,EAAExD,CAAC,CAAC6C;EAAO,CAAC,EAAEP,GAAG,CAACS,IAAI,CAAC;EAC/D,MAAMyE,QAAQ,GAAG,MAAMzB,uBAAc,CAAC0B,WAAW,CAAC,CAAC;EAEnD,MAAMC,yBAAgB,CAACC,WAAW,CAACnE,OAAO,EAAE;IAC1CoE,OAAO,EAAEJ,QAAQ,CAAC/C,GAAG,CAAEoD,CAAC,IAAKA,CAAC,CAACjB,EAAE;EACnC,CAAC,CAAC;EAEF,OAAO;IACLkB,OAAO,EAAE;EACX,CAAC;AACH,CAAC,CACH,CAAC;AAED7F,WAAW,CAACE,IAAI,CACd,iBAAiB,EACjB,IAAAiB,WAAM,EAAC,CAAC,OAAO,CAAC,CAAC,EACjB,IAAAhB,aAAI,EAAC,CAAC,EACN,IAAAC,wBAAW,EAAC,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC9B,MAAM;IAAEwF;EAAU,CAAC,GAAG/H,CAAC,CAAC4C,QAAQ,CAC9B;IACEmF,SAAS,EAAE/H,CAAC,CAAC6C;EACf,CAAC,EACDP,GAAG,CAACS,IACN,CAAC;EAED,MAAMiF,KAA4B,GAAG,CACnC,MAAMC,mBAAM,CAACC,GAAG,CAACC,QAAQ,CAAC,aAAa,EAAE,YAAY,CAAC,EACtDC,QAAQ,CAACC,IAAI,CAAEL,KAAoB,IAAKA,KAAK,CAACxF,IAAI,KAAKuF,SAAS,CAAC;EAEnE,IAAI,CAACC,KAAK,EAAE;IACV,OAAO,IAAAM,yCAAgB,EAACC,qCAAY,CAACC,SAAS,CAAC;EACjD;EAEA,MAAMC,kBAAkB,GAAGT,KAAK,CAACU,YAAY,CAACjE,GAAG,CAAEkE,CAAC,IAClD,IAAAtD,8BAAiB,EAACsD,CAAC,CAAC/B,EAAE,CACxB,CAAC;EAED,MAAMgC,cAAc,GAAG,MAAMhD,OAAO,CAACC,GAAG,CACtC4C,kBAAkB,CAAChE,GAAG,CAAC,MAAOa,KAAK,IAAK;IACtC,MAAMQ,IAAI,GAAG,MAAMC,uBAAc,CAAC8C,oBAAoB,CAACvD,KAAK,CAAC;IAC7D,IAAI,CAACQ,IAAI,EAAE;MACT;;MAEA,OAAO,MAAMC,uBAAc,CAAC+C,UAAU,CAAC;QACrC1D,WAAW,EAAEE,KAAK;QAClB/B,IAAI,EAAE,SAAS;QACfmC,SAAS,EAAE,KAAK;QAChBH,GAAG,EAAE,IAAI;QACT/C,IAAI,EAAE,SAAS;QACfiD,MAAM,EAAE,YAAYsC,SAAS;MAC/B,CAAC,CAAC;IACJ;EACF,CAAC,CACH,CAAC;EAED,OAAO;IAAEa;EAAe,CAAC;AAC3B,CAAC,CACH,CAAC;AAED3G,WAAW,CAAC8G,MAAM,CAChB,aAAa,EACb,IAAA3F,WAAM,EAAC,CAAC,OAAO,CAAC,CAAC,EACjB,IAAAf,wBAAW,EAAC,MAAOC,GAAG,IAAK;EACzB,MAAM;IAAEyF,SAAS;IAAEvE;EAAQ,CAAC,GAAGxD,CAAC,CAAC4C,QAAQ,CACvC;IACEmF,SAAS,EAAE/H,CAAC,CAAC6C,MAAM;IACnBW,OAAO,EAAExD,CAAC,CAAC6C;EACb,CAAC,EACDP,GAAG,CAACS,IACN,CAAC;EAED,MAAMiG,MAAM,GAAG,GAAGjB,SAAS,EAAE;EAE7B,MAAM;IAAEH;EAAQ,CAAC,GAAG,MAAMF,yBAAgB,CAACuB,YAAY,CAACzF,OAAO,CAAC;EAEhE,MAAMgE,QAAQ,GAAG,MAAMzB,uBAAc,CAACmD,gBAAgB,CAACF,MAAM,CAAC;EAE9D,MAAMG,eAAe,GAAG3B,QAAQ,CAAC/C,GAAG,CAAEqB,IAAI,IAAKA,IAAI,CAACc,EAAE,CAAC;EAEvD,MAAMwC,kBAAkB,GAAGxB,OAAO,CAACzB,MAAM,CACtCS,EAAE,IAAK,CAACuC,eAAe,CAACE,QAAQ,CAACzC,EAAE,CACtC,CAAC;EAED,MAAMc,yBAAgB,CAACC,WAAW,CAACnE,OAAO,EAAE;IAC1CoE,OAAO,EAAEwB;EACX,CAAC,CAAC;EAEF,MAAMpG,MAAM,GAAG,MAAM4C,OAAO,CAACC,GAAG,CAC9B2B,QAAQ,CAAC/C,GAAG,CAAEqB,IAAI,IAAK;IACrB,OAAOC,uBAAc,CAACuD,cAAc,CAACxD,IAAI,CAACc,EAAE,CAAC;EAC/C,CAAC,CACH,CAAC;EAED,OAAO;IACLuC,eAAe;IACfC;EACF,CAAC;AACH,CAAC,CACH,CAAC;AAEDnH,WAAW,CAACE,IAAI,CACd,gBAAgB,EAChB,IAAAiB,WAAM,EAAC,CAAC,OAAO,CAAC,CAAC,EACjB,IAAAhB,aAAI,EAAC,CAAC,EACN,IAAAC,wBAAW,EAAC,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC9B,MAAM;IAAEwF,SAAS;IAAEvE;EAAQ,CAAC,GAAGxD,CAAC,CAAC4C,QAAQ,CACvC;IACEmF,SAAS,EAAE/H,CAAC,CAAC6C,MAAM;IACnBW,OAAO,EAAExD,CAAC,CAAC6C;EACb,CAAC,EACDP,GAAG,CAACS,IACN,CAAC;EAED,MAAMiF,KAA4B,GAAGuB,IAAI,CAACC,KAAK,CAC7CC,WAAE,CAACC,YAAY,CAAC,eAAe,EAAE;IAAEC,QAAQ,EAAE;EAAQ,CAAC,CACxD,CAAC;EAED,IAAI,CAAC3B,KAAK,EAAE;IACV,OAAO,IAAAM,yCAAgB,EAACC,qCAAY,CAACC,SAAS,CAAC;EACjD;EAEA,MAAMoB,KAAK,GAAG,MAAMlC,yBAAgB,CAACuB,YAAY,CAACzF,OAAO,CAAC;EAE1D,IAAI,CAACoG,KAAK,EAAE;IACV,OAAO,IAAAtB,yCAAgB,EAACC,qCAAY,CAACC,SAAS,CAAC;EACjD;EAEA,MAAMhB,QAAQ,GAAG,MAAMzB,uBAAc,CAACmD,gBAAgB,CACpD,YAAYnB,SAAS,EACvB,CAAC;EAED,MAAM8B,WAAW,GAAG,IAAIC,GAAG,CAAyB,CAAC;EACrD,KAAK,MAAMjC,CAAC,IAAIL,QAAQ,EAAE;IACxB,MAAMuC,GAAG,GAAG,IAAAC,kCAAqB,EAACnC,CAAC,CAACzC,WAAW,CAAC;IAChD,IAAI2E,GAAG,CAACE,MAAM,KAAK,EAAE,IAAIF,GAAG,CAACE,MAAM,KAAK,EAAE,EAAE;MAC1C,IAAI,CAACJ,WAAW,CAACpI,GAAG,CAACsI,GAAG,CAAC,EAAEF,WAAW,CAAClI,GAAG,CAACoI,GAAG,EAAElC,CAAC,CAAC;IACpD;EACF;EAEA,MAAMqC,UAAU,GAAG,IAAIC,GAAG,CAACP,KAAK,CAAChC,OAAO,IAAI,EAAE,CAAC;EAC/C,MAAMwC,QAA0B,GAAG,EAAE;EACrC,MAAMC,WAAW,GAAG,IAAIF,GAAG,CAAS,CAAC;EAErC,KAAK,MAAMxB,CAAC,IAAIX,KAAK,CAACU,YAAY,EAAE;IAClC,MAAMqB,GAAG,GAAG,IAAAO,4BAAe,EAAC3B,CAAC,CAAC/B,EAAE,CAAC;IACjC,IAAI,CAACmD,GAAG,EAAE,SAAS,CAAC;IACpB,MAAMjE,IAAI,GAAG+D,WAAW,CAACnI,GAAG,CAACqI,GAAG,CAAC;IACjC,IAAI,CAACjE,IAAI,EAAE,SAAS,CAAC;IACrB,IAAIoE,UAAU,CAACzI,GAAG,CAACqE,IAAI,CAACc,EAAE,CAAC,EAAE,SAAS,CAAC;IACvC,IAAIyD,WAAW,CAAC5I,GAAG,CAACqE,IAAI,CAACc,EAAE,CAAC,EAAE,SAAS,CAAC;;IAExCwD,QAAQ,CAACG,IAAI,CAACzE,IAAI,CAAC;IACnBuE,WAAW,CAACG,GAAG,CAAC1E,IAAI,CAACc,EAAE,CAAC;EAC1B;EAEA,MAAMc,yBAAgB,CAACC,WAAW,CAACiC,KAAK,CAAChD,EAAE,EAAE;IAC3CgB,OAAO,EAAE,CAAC,GAAGgC,KAAK,CAAChC,OAAO,EAAE,GAAGwC,QAAQ,CAAC3F,GAAG,CAAEoD,CAAC,IAAKA,CAAC,CAACjB,EAAE,CAAC;EAC1D,CAAC,CAAC;EAEF,MAAM6D,OAAO,GAAGL,QAAQ,CAAC3F,GAAG,CAAEoD,CAAC,IAAK,IAAA3B,uBAAU,EAAC2B,CAAC,CAACzC,WAAW,CAAC,CAAC;EAE9D,IAAAiB,4BAAgB,EAACoE,OAAO,EAAEb,KAAK,CAAChD,EAAE,EAAEoB,KAAK,CAACxF,IAAI,CAAC;EAE/C,OAAO;IACLsF,OAAO,EAAE,IAAI;IACb1D,IAAI,EAAEqG;EACR,CAAC;AACH,CAAC,CACH,CAAC;AAEDxI,WAAW,CAACP,GAAG,CACb,aAAa,EACb,IAAA0B,WAAM,EAAC,CAAC,OAAO,CAAC,CAAC,EACjB,IAAAhB,aAAI,EAAC,CAAC,EACN,IAAAC,wBAAW,EAAC,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC9B,MAAMyF,KAAkB,GAAG,CACzB,MAAMC,mBAAM,CAACC,GAAG,CAACC,QAAQ,CAAC,aAAa,EAAE,YAAY,CAAC,EACtDC,QAAQ;EAEV,OAAOJ,KAAK;AACd,CAAC,CACH,CAAC;AAAC,IAAA0C,QAAA,GAAAC,OAAA,CAAA3J,OAAA,GAEaiB,WAAW","ignoreList":[]}