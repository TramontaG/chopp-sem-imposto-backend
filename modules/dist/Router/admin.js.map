{"version":3,"file":"admin.js","names":["_express","require","_SafeRequest","V","_interopRequireWildcard","_adminsController","_interopRequireDefault","_JWT","_cookieParser","_SafeDatabaseTransaction","_sanitizeCity","_userController","_eventsController","_fs","_KozzModule","_phoneNumber","_sendInvite","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","adminRouter","Router","post","json","safeRequest","req","res","name","password","permissions","username","validate","string","array","body","result","adminsController","createAdmin","safeReturnTransaction","useJWT","eventId","event","eventsController","getEventById","transactionError","FAIL_REASONS","NOT_FOUND","attendees","Promise","all","map","userId","user","userController","getUserById","updateUser","confirmed","confirmedAttendees","filter","Boolean","success","confirmedCount","length","ageBegin","ageEnd","city","limit","index","session","number","requestResult","fetch","headers","Cookie","ok","status","send","data","then","resp","message","userList","affiliate","ageAsNumber","Number","age","split","currYear","Date","getFullYear","birthYear","birthDate","phoneNumber","formatPhoneNumber","phone","DOB","getTime","source","jids","createUserAvoidingDuplicates","isTransactionSuccessful","phoneToJid","sendInviteToList","cookieParser","loginTransaction","login","jwt","generateJwt","id","cookie","httpOnly","expires","now","sameSite","secure","suggestions","dryRunNormalizeCities","suggestion","after","allUsers","getAllUsers","updateEvent","invited","u","groupName","group","module","ask","boundary","response","find","participantsPhones","participants","p","createdUsersID","getUserByPhoneNumber","createUser","delete","origin","getUsersByOrigin","userIdsToRemove","updatedInvitedList","includes","hardDeleteUser","JSON","parse","fs","readFileSync","encoding","phoneToUser","Map","nat","userPhoneToBrNational","invitedSet","Set","toInvite","seenUserIds","jidToBrNational","push","add","jidList","_default","exports"],"sources":["../../src/Router/admin.ts"],"sourcesContent":["import { Router, json, request, response } from \"express\";\nimport { safeRequest } from \"../Util/SafeRequest\";\nimport * as V from \"../Util/ZodValidation\";\nimport adminsController from \"../database/controllers/adminsController\";\nimport { generateJwt, useJWT } from \"../JWT\";\nimport cookieParser from \"cookie-parser\";\nimport {\n  FAIL_REASONS,\n  isTransactionSuccessful,\n  safeReturnTransaction,\n  transactionError,\n  type TransactionSuccess,\n} from \"../Util/SafeDatabaseTransaction\";\nimport { dryRunNormalizeCities } from \"../Util/sanitizeCity\";\nimport userController from \"../database/controllers/userController\";\nimport eventsController from \"../database/controllers/eventsController.\";\nimport fs from \"fs\";\nimport module from \"../Kozz-Module\";\nimport type { GroupChat, GroupChatData } from \"kozz-types\";\nimport {\n  formatPhoneNumber,\n  jidToBrNational,\n  phoneToJid,\n  userPhoneToBrNational,\n} from \"../Util/phoneNumber\";\nimport type { WithID } from \"../database/schemas\";\nimport { sendInviteToList } from \"../Kozz-Module/Methods/sendInvite\";\nimport UserRouter from \"./Users\";\n\nconst adminRouter = Router();\n\nadminRouter.post(\n  \"/create\",\n  // useJWT([\"create-account\"]),\n  json(),\n  safeRequest(async (req, res) => {\n    const { name, password, permissions, username } = V.validate(\n      {\n        username: V.string,\n        password: V.string,\n        permissions: V.array(V.string),\n        name: V.string,\n      },\n      req.body\n    );\n\n    const result = await adminsController.createAdmin({\n      name,\n      password,\n      permissions,\n      username,\n    });\n\n    return safeReturnTransaction(result);\n  })\n);\n\ntype Affiliate = {\n  id: number;\n  affiliatedId: string;\n  name: string;\n  state: string;\n  city: string;\n  disaffiliation: string;\n  age: string;\n  exemption: string;\n  filiation: string;\n  filiationSolicitation: string;\n  status: string;\n  phone: string;\n};\n\nadminRouter.post(\n  \"/confirm_attendees\",\n  useJWT([\"admin\"]),\n  json(),\n  safeRequest(async (req, res) => {\n    const { eventId } = V.validate(\n      {\n        eventId: V.string,\n      },\n      req.body\n    );\n\n    const event = await eventsController.getEventById(eventId);\n    if (!event) {\n      return transactionError(FAIL_REASONS.NOT_FOUND);\n    }\n\n    const attendees = await Promise.all(\n      event.attendees.map(async (userId) => {\n        const user = await userController.getUserById(userId);\n        if (user) {\n          await userController.updateUser(userId, { confirmed: true });\n          return user;\n        }\n        return null;\n      })\n    );\n\n    const confirmedAttendees = attendees.filter(Boolean);\n\n    return {\n      success: true,\n      confirmedCount: confirmedAttendees.length,\n      attendees: confirmedAttendees,\n    };\n  })\n);\n\nadminRouter.post(\n  \"/invite_novo\",\n  useJWT([\"admin\"]),\n  safeRequest(async (req, res) => {\n    const { ageBegin, ageEnd, city, eventId, limit, index, session } =\n      V.validate(\n        {\n          ageBegin: V.number,\n          ageEnd: V.number,\n          city: V.number,\n          eventId: V.string,\n          limit: V.number,\n          index: V.number,\n          session: V.string,\n        },\n        req.body\n      );\n\n    const requestResult = await fetch(\n      `https://gestao.novo.org.br/api/filiados/json/?ageBegin=${ageBegin}&ageEnd=${ageEnd}&city=${city}&state2=26&status=7&ordination=ASC&limit=${limit}&index=${index}`,\n      {\n        headers: {\n          Cookie: \"PHPSESSID=\" + session,\n        },\n      }\n    );\n\n    if (!requestResult.ok) {\n      return res.status(requestResult.status).send(await requestResult.json());\n    }\n\n    const data = await requestResult\n      .json()\n      .then((resp: any) => resp.message as Affiliate[]);\n\n    const userList = data.map((affiliate) => {\n      const ageAsNumber = Number(affiliate.age.split(\" \")[0]);\n      const currYear = new Date().getFullYear();\n      const birthYear = currYear - ageAsNumber;\n      const birthDate = new Date(birthYear, 0, 1);\n\n      return {\n        name: affiliate.name,\n        phoneNumber: formatPhoneNumber(affiliate.phone),\n        city: affiliate.city,\n        DOB: birthDate.getTime(),\n        source: \"novo\" as WithID<\"user\">[\"source\"],\n        confirmed: false,\n      };\n    });\n\n    const jids = (\n      await Promise.all(\n        userList.map(async (user) => {\n          const result = await userController.createUserAvoidingDuplicates(\n            user\n          );\n          if (isTransactionSuccessful(result)) {\n            return phoneToJid(user.phoneNumber);\n          }\n        })\n      )\n    ).filter(Boolean) as string[];\n\n    sendInviteToList(jids, eventId);\n\n    return {\n      userList,\n      jids,\n    };\n  })\n);\n\nadminRouter.get(\n  \"/ok\",\n  useJWT([\"admin\"]),\n  safeRequest(async (req, res) => {\n    return { message: \"ok\" };\n  })\n);\n\nadminRouter.post(\n  \"/login\",\n  json(),\n  cookieParser(),\n  safeRequest(async (req, res) => {\n    const { username, password } = V.validate(\n      {\n        username: V.string,\n        password: V.string,\n      },\n      req.body\n    );\n\n    const loginTransaction = await adminsController.login(username, password);\n\n    if (!isTransactionSuccessful(loginTransaction)) {\n      return safeReturnTransaction(loginTransaction);\n    }\n\n    const result = loginTransaction.data;\n\n    const jwt = generateJwt({\n      userId: result.id,\n      username: result.name,\n    });\n\n    res.cookie(\"jwt\", jwt, {\n      httpOnly: true,\n\n      expires: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n      sameSite: \"none\",\n      secure: true,\n    });\n\n    return { jwt };\n  })\n);\n\nadminRouter.post(\"/sanitize-city\", async (req, res) => {\n  const suggestions = await dryRunNormalizeCities();\n\n  const result = await Promise.all(\n    suggestions.map((suggestion) => {\n      userController.updateUser(suggestion.id, {\n        city: suggestion.after,\n      });\n    })\n  );\n\n  res.send(result);\n});\n\nadminRouter.post(\n  \"/patch_event\",\n  useJWT([\"admin\"]),\n  json(),\n  safeRequest(async (req) => {\n    const { eventId } = V.validate({ eventId: V.string }, req.body);\n    const allUsers = await userController.getAllUsers();\n\n    await eventsController.updateEvent(eventId, {\n      invited: allUsers.map((u) => u.id),\n    });\n\n    return {\n      success: true,\n    };\n  })\n);\n\nadminRouter.post(\n  \"/add_from_group\",\n  useJWT([\"admin\"]),\n  json(),\n  safeRequest(async (req, res) => {\n    const { groupName } = V.validate(\n      {\n        groupName: V.string,\n      },\n      req.body\n    );\n\n    const group: GroupChat | undefined = (\n      await module.ask.boundary(\"iae-baileys\", \"all_groups\")\n    ).response.find((group: GroupChatData) => group.name === groupName);\n\n    if (!group) {\n      return transactionError(FAIL_REASONS.NOT_FOUND);\n    }\n\n    const participantsPhones = group.participants.map((p) =>\n      formatPhoneNumber(p.id)\n    );\n\n    const createdUsersID = await Promise.all(\n      participantsPhones.map(async (phone) => {\n        const user = await userController.getUserByPhoneNumber(phone);\n        if (!user) {\n          // return phone;\n\n          return await userController.createUser({\n            phoneNumber: phone,\n            city: \"no_city\",\n            confirmed: false,\n            DOB: null,\n            name: \"no_name\",\n            source: `whatsapp-${groupName}`,\n          });\n        }\n      })\n    );\n\n    return { createdUsersID };\n  })\n);\n\nadminRouter.delete(\n  \"/from_group\",\n  useJWT([\"admin\"]),\n  safeRequest(async (req) => {\n    const { groupName, eventId } = V.validate(\n      {\n        groupName: V.string,\n        eventId: V.string,\n      },\n      req.body\n    );\n\n    const origin = `${groupName}`;\n\n    const { invited } = await eventsController.getEventById(eventId);\n\n    const allUsers = await userController.getUsersByOrigin(origin);\n\n    const userIdsToRemove = allUsers.map((user) => user.id);\n\n    const updatedInvitedList = invited.filter(\n      (id) => !userIdsToRemove.includes(id)\n    );\n\n    await eventsController.updateEvent(eventId, {\n      invited: updatedInvitedList,\n    });\n\n    const result = await Promise.all(\n      allUsers.map((user) => {\n        return userController.hardDeleteUser(user.id);\n      })\n    );\n\n    return {\n      userIdsToRemove,\n      updatedInvitedList,\n    };\n  })\n);\n\nadminRouter.post(\n  \"/send_to_group\",\n  useJWT([\"admin\"]),\n  json(),\n  safeRequest(async (req, res) => {\n    const { groupName, eventId } = V.validate(\n      {\n        groupName: V.string,\n        eventId: V.string,\n      },\n      req.body\n    );\n\n    const group: GroupChat | undefined = JSON.parse(\n      fs.readFileSync(\"src/temp.json\", { encoding: \"utf-8\" })\n    );\n\n    if (!group) {\n      return transactionError(FAIL_REASONS.NOT_FOUND);\n    }\n\n    const event = await eventsController.getEventById(eventId);\n\n    if (!event) {\n      return transactionError(FAIL_REASONS.NOT_FOUND);\n    }\n\n    const allUsers = await userController.getUsersByOrigin(\n      `whatsapp-${groupName}`\n    );\n\n    const phoneToUser = new Map<string, WithID<\"user\">>();\n    for (const u of allUsers) {\n      const nat = userPhoneToBrNational(u.phoneNumber);\n      if (nat.length === 10 || nat.length === 11) {\n        if (!phoneToUser.has(nat)) phoneToUser.set(nat, u);\n      }\n    }\n\n    const invitedSet = new Set(event.invited ?? []);\n    const toInvite: WithID<\"user\">[] = [];\n    const seenUserIds = new Set<string>();\n\n    for (const p of group.participants) {\n      const nat = jidToBrNational(p.id);\n      if (!nat) continue; // ignora JIDs fora do padrão BR\n      const user = phoneToUser.get(nat);\n      if (!user) continue; // participante não cadastrado no banco\n      if (invitedSet.has(user.id)) continue; // já convidado\n      if (seenUserIds.has(user.id)) continue; // evita duplicata no mesmo run\n\n      toInvite.push(user);\n      seenUserIds.add(user.id);\n    }\n\n    await eventsController.updateEvent(event.id, {\n      invited: [...event.invited, ...toInvite.map((u) => u.id)],\n    });\n\n    const jidList = toInvite.map((u) => phoneToJid(u.phoneNumber));\n\n    sendInviteToList(jidList, event.id, group.name);\n\n    return {\n      success: true,\n      data: jidList,\n    };\n  })\n);\n\nadminRouter.get(\n  \"/group_list\",\n  useJWT([\"admin\"]),\n  json(),\n  safeRequest(async (req, res) => {\n    const group: GroupChat[] = (\n      await module.ask.boundary(\"iae-baileys\", \"all_groups\")\n    ).response;\n\n    return group;\n  })\n);\n\nexport default adminRouter;\n"],"mappings":"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","ignoreList":[]}