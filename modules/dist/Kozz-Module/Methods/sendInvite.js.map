{"version":3,"file":"sendInvite.js","names":["_eventsController","_interopRequireDefault","require","_mimeTypes","_","_Messages","_yaseq","_sleep","_zeroWidth","_jsxRuntime","e","__esModule","default","sendMessageQueue","createTaskQueue","sendInviteMessage","contact","eventId","groupName","bannerUrl","eventsController","getEventById","media","data","transportType","duration","fileName","split","at","mimeType","mime","lookup","sizeInBytes","stickerTags","undefined","module","sendMessage","withMedia","jsx","InviteMessage","randomZeroWidth","min","max","exports","sendInviteToList","contactList","Promise","all","map","contactId","index","awaitExecution","console","log","length","sleep","Math","random"],"sources":["../../../src/Kozz-Module/Methods/sendInvite.tsx"],"sourcesContent":["import type { Media } from \"kozz-types\";\nimport eventsController from \"../../database/controllers/eventsController.\";\nimport mime from \"mime-types\";\nimport module from \"..\";\nimport { InviteMessage } from \"../Messages\";\nimport { createTaskQueue } from \"yaseq\";\nimport { sleep } from \"../../Util/sleep\";\nimport { randomZeroWidth } from \"../../Util/zero-width\";\n\nconst sendMessageQueue = createTaskQueue();\n\nexport const sendInviteMessage = async (\n  contact: string,\n  eventId: string,\n  groupName?: string\n) => {\n  const { bannerUrl } = await eventsController.getEventById(eventId);\n\n  const media: Media | undefined = bannerUrl\n    ? {\n        data: bannerUrl,\n        transportType: \"url\",\n        duration: null,\n        fileName: bannerUrl.split(\"/\").at(-1)!,\n        mimeType: mime.lookup(bannerUrl.split(\"/\").at(-1)!) || \"image/jpeg\",\n        sizeInBytes: 0,\n        stickerTags: [],\n      }\n    : undefined;\n\n  media\n    ? module.sendMessage.withMedia(\n        contact,\n        \"iae-baileys\",\n        <InviteMessage groupName={groupName} /> +\n          randomZeroWidth({ min: 0, max: 15 }),\n        media\n      )\n    : module.sendMessage(\n        contact,\n        \"iae-baileys\",\n        <InviteMessage groupName={groupName} /> +\n          randomZeroWidth({ min: 0, max: 15 })\n      );\n};\n\nexport const sendInviteToList = async (\n  contactList: string[],\n  eventId: string,\n  groupName?: string\n) => {\n  return Promise.all(\n    contactList.map(async (contactId, index) => {\n      return sendMessageQueue.awaitExecution(async () => {\n        console.log(\n          `Sending message to ${contactId} (${index + 1}/${contactList.length})`\n        );\n\n        await sendInviteMessage(contactId, eventId, groupName);\n        return await sleep(Math.random() * 15 * 1000 + 10000); // between 10 and 25 seconds\n      });\n    })\n  );\n};\n"],"mappings":";;;;;;AACA,IAAAA,iBAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,UAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,CAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,SAAA,GAAAH,OAAA;AACA,IAAAI,MAAA,GAAAJ,OAAA;AACA,IAAAK,MAAA,GAAAL,OAAA;AACA,IAAAM,UAAA,GAAAN,OAAA;AAAwD,IAAAO,WAAA,GAAAP,OAAA;AAAA,SAAAD,uBAAAS,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAExD,MAAMG,gBAAgB,GAAG,IAAAC,sBAAe,EAAC,CAAC;AAEnC,MAAMC,iBAAiB,GAAG,MAAAA,CAC/BC,OAAe,EACfC,OAAe,EACfC,SAAkB,KACf;EACH,MAAM;IAAEC;EAAU,CAAC,GAAG,MAAMC,yBAAgB,CAACC,YAAY,CAACJ,OAAO,CAAC;EAElE,MAAMK,KAAwB,GAAGH,SAAS,GACtC;IACEI,IAAI,EAAEJ,SAAS;IACfK,aAAa,EAAE,KAAK;IACpBC,QAAQ,EAAE,IAAI;IACdC,QAAQ,EAAEP,SAAS,CAACQ,KAAK,CAAC,GAAG,CAAC,CAACC,EAAE,CAAC,CAAC,CAAC,CAAE;IACtCC,QAAQ,EAAEC,kBAAI,CAACC,MAAM,CAACZ,SAAS,CAACQ,KAAK,CAAC,GAAG,CAAC,CAACC,EAAE,CAAC,CAAC,CAAC,CAAE,CAAC,IAAI,YAAY;IACnEI,WAAW,EAAE,CAAC;IACdC,WAAW,EAAE;EACf,CAAC,GACDC,SAAS;EAEbZ,KAAK,GACDa,SAAM,CAACC,WAAW,CAACC,SAAS,CAC1BrB,OAAO,EACP,aAAa,EACb,IAAAP,WAAA,CAAA6B,GAAA,EAACjC,SAAA,CAAAkC,aAAa;IAACrB,SAAS,EAAEA;EAAU,CAAE,CAAC,GACrC,IAAAsB,0BAAe,EAAC;IAAEC,GAAG,EAAE,CAAC;IAAEC,GAAG,EAAE;EAAG,CAAC,CAAC,EACtCpB,KACF,CAAC,GACDa,SAAM,CAACC,WAAW,CAChBpB,OAAO,EACP,aAAa,EACb,IAAAP,WAAA,CAAA6B,GAAA,EAACjC,SAAA,CAAAkC,aAAa;IAACrB,SAAS,EAAEA;EAAU,CAAE,CAAC,GACrC,IAAAsB,0BAAe,EAAC;IAAEC,GAAG,EAAE,CAAC;IAAEC,GAAG,EAAE;EAAG,CAAC,CACvC,CAAC;AACP,CAAC;AAACC,OAAA,CAAA5B,iBAAA,GAAAA,iBAAA;AAEK,MAAM6B,gBAAgB,GAAG,MAAAA,CAC9BC,WAAqB,EACrB5B,OAAe,EACfC,SAAkB,KACf;EACH,OAAO4B,OAAO,CAACC,GAAG,CAChBF,WAAW,CAACG,GAAG,CAAC,OAAOC,SAAS,EAAEC,KAAK,KAAK;IAC1C,OAAOrC,gBAAgB,CAACsC,cAAc,CAAC,YAAY;MACjDC,OAAO,CAACC,GAAG,CACT,sBAAsBJ,SAAS,KAAKC,KAAK,GAAG,CAAC,IAAIL,WAAW,CAACS,MAAM,GACrE,CAAC;MAED,MAAMvC,iBAAiB,CAACkC,SAAS,EAAEhC,OAAO,EAAEC,SAAS,CAAC;MACtD,OAAO,MAAM,IAAAqC,YAAK,EAACC,IAAI,CAACC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC;IACzD,CAAC,CAAC;EACJ,CAAC,CACH,CAAC;AACH,CAAC;AAACd,OAAA,CAAAC,gBAAA,GAAAA,gBAAA","ignoreList":[]}